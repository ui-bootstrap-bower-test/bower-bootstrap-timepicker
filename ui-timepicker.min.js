angular.module("ui.bootstrap.timepicker",[]).constant("timepickerConfig",{hourStep:1,minuteStep:1,showMeridian:!0,meridians:null,readonlyInput:!1,mousewheel:!0}).controller("TimepickerController",["$scope","$attrs","$parse","$log","$locale","timepickerConfig",function(e,n,i,t,r,u){function a(){var n=parseInt(e.hours,10),i=e.showMeridian?n>0&&13>n:n>=0&&24>n;return i?(e.showMeridian&&(12===n&&(n=0),e.meridian===h[1]&&(n+=12)),n):void 0}function o(){var n=parseInt(e.minutes,10);return n>=0&&60>n?n:void 0}function s(e){return angular.isDefined(e)&&e.toString().length<2?"0"+e:e}function l(e){d(),f.$setViewValue(new Date(m)),c(e)}function d(){f.$setValidity("time",!0),e.invalidHours=!1,e.invalidMinutes=!1}function c(n){var i=m.getHours(),t=m.getMinutes();e.showMeridian&&(i=0===i||12===i?12:i%12),e.hours="h"===n?i:s(i),e.minutes="m"===n?t:s(t),e.meridian=m.getHours()<12?h[0]:h[1]}function p(e){var n=new Date(m.getTime()+6e4*e);m.setHours(n.getHours(),n.getMinutes()),l()}var m=new Date,f={$setViewValue:angular.noop},h=angular.isDefined(n.meridians)?e.$parent.$eval(n.meridians):u.meridians||r.DATETIME_FORMATS.AMPMS;this.init=function(i,t){f=i,f.$render=this.render;var r=t.eq(0),a=t.eq(1),o=angular.isDefined(n.mousewheel)?e.$parent.$eval(n.mousewheel):u.mousewheel;o&&this.setupMousewheelEvents(r,a),e.readonlyInput=angular.isDefined(n.readonlyInput)?scope.$parent.$eval(n.readonlyInput):u.readonlyInput,this.setupInputEvents(r,a)};var v=u.hourStep;n.hourStep&&e.$parent.$watch(i(n.hourStep),function(e){v=parseInt(e,10)});var g=u.minuteStep;n.minuteStep&&e.$parent.$watch(i(n.minuteStep),function(e){g=parseInt(e,10)}),e.showMeridian=u.showMeridian,n.showMeridian&&e.$parent.$watch(i(n.showMeridian),function(n){if(e.showMeridian=!!n,f.$error.time){var i=a(),t=o();angular.isDefined(i)&&angular.isDefined(t)&&(m.setHours(i),l())}else c()}),this.setupMousewheelEvents=function(n,i){var t=function(e){e.originalEvent&&(e=e.originalEvent);var n=e.wheelDelta?e.wheelDelta:-e.deltaY;return e.detail||n>0};n.bind("mousewheel wheel",function(n){e.$apply(t(n)?e.incrementHours():e.decrementHours()),n.preventDefault()}),i.bind("mousewheel wheel",function(n){e.$apply(t(n)?e.incrementMinutes():e.decrementMinutes()),n.preventDefault()})},this.setupInputEvents=function(n,i){if(e.readonlyInput)return e.updateHours=angular.noop,void(e.updateMinutes=angular.noop);var t=function(n,i){f.$setViewValue(null),f.$setValidity("time",!1),angular.isDefined(n)&&(e.invalidHours=n),angular.isDefined(i)&&(e.invalidMinutes=i)};e.updateHours=function(){var e=a();angular.isDefined(e)?(m.setHours(e),l("h")):t(!0)},n.bind("blur",function(){!e.validHours&&e.hours<10&&e.$apply(function(){e.hours=s(e.hours)})}),e.updateMinutes=function(){var e=o();angular.isDefined(e)?(m.setMinutes(e),l("m")):t(void 0,!0)},i.bind("blur",function(){!e.invalidMinutes&&e.minutes<10&&e.$apply(function(){e.minutes=s(e.minutes)})})},this.render=function(){var e=f.$modelValue?new Date(f.$modelValue):null;isNaN(e)?(f.$setValidity("time",!1),t.error('Timepicker directive: "ng-model" value must be a Date object, a number of milliseconds since 01.01.1970 or a string representing an RFC2822 or ISO 8601 date.')):(e&&(m=e),d(),c())},e.incrementHours=function(){p(60*v)},e.decrementHours=function(){p(60*-v)},e.incrementMinutes=function(){p(g)},e.decrementMinutes=function(){p(-g)},e.toggleMeridian=function(){p(720*(m.getHours()<12?1:-1))}}]).directive("timepicker",function(){return{restrict:"EA",require:["timepicker","?^ngModel"],controller:"TimepickerController",replace:!0,scope:{},templateUrl:"template/timepicker/timepicker.html",link:function(e,n,i,t){var r=t[0],u=t[1];u&&r.init(u,n.find("input"))}}});